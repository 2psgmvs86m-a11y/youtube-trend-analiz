<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DetaylÄ± Trend Analizi</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <nav>
        <div class="container">
            <div class="logo">ğŸ”´ YT Analiz</div>
            <ul>
                <li><a href="/static/index.html">Ana Sayfa</a></li>
                <li><a href="/static/trend_analysis.html" class="active">ğŸ“Š DetaylÄ± Trendler</a></li>
                <li><a href="/static/channel_query.html">ğŸ” Kanal Sorgula</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
            <h1>ğŸ“Š Piyasa Analizi & NiÅŸ KeÅŸfi</h1>
            <div>
                <select id="region-select">
                    <option value="TR">TÃ¼rkiye</option>
                    <option value="US">Amerika (Global)</option>
                    <option value="DE">Almanya</option>
                </select>
                <button id="refresh-btn">Analiz Et</button>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <div class="card">
                <h3>ğŸ”‘ En Ã‡ok Aranan Anahtar Kelimeler</h3>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">Trend videolarda en sÄ±k geÃ§en ve rekabet yaratan kelimeler.</p>
                <div id="keyword-cloud" class="tag-cloud">Veri bekleniyor...</div>
            </div>
            <div class="card">
                <h3>âš¡ Rekabet / NiÅŸ Durumu</h3>
                <div id="niche-stats">Veri bekleniyor...</div>
            </div>
        </div>

        <h2>ğŸ“ˆ Trend Listesi (Top 50)</h2>
        <div id="trend-list" class="grid-view"></div>
    </main>

    <script>
        const btn = document.getElementById('refresh-btn');
        
        async function loadData() {
            const region = document.getElementById('region-select').value;
            document.getElementById('trend-list').innerHTML = 'YÃ¼kleniyor...';
            
            const res = await fetch(`/api/trending?region=${region}&limit=50`);
            const data = await res.json();
            
            // 1. Video Listesini DÃ¶k
            const list = document.getElementById('trend-list');
            list.innerHTML = '';
            let allTags = [];
            
            data.forEach(video => {
                if(video.tags) allTags.push(...video.tags); // Etiketleri topla
                list.innerHTML += `
                    <div class="video-card">
                        <img src="${video.thumbnail}" class="video-thumb">
                        <div class="video-info">
                            <div class="video-title">${video.title}</div>
                            <div class="video-meta">
                                ${video.channel} <br>
                                ğŸ‘ï¸ ${new Intl.NumberFormat('tr-TR').format(video.views)}
                            </div>
                        </div>
                    </div>
                `;
            });

            // 2. Kelime Analizi Yap (Basit Frekans)
            const frequency = {};
            allTags.forEach(tag => {
                tag = tag.toLowerCase();
                frequency[tag] = (frequency[tag] || 0) + 1;
            });
            
            // En Ã§ok geÃ§en 15 kelimeyi bul
            const sortedTags = Object.entries(frequency).sort((a,b) => b[1] - a[1]).slice(0, 15);
            
            // Ekrana Bas
            const cloud = document.getElementById('keyword-cloud');
            cloud.innerHTML = sortedTags.map(item => 
                `<span class="tag" style="background: ${item[1] > 2 ? '#ffcccc' : '#eee'}">#${item[0]} (${item[1]})</span>`
            ).join('');

            // 3. NiÅŸ Analizi
            document.getElementById('niche-stats').innerHTML = `
                <p>Bu bÃ¶lgedeki trendlerde toplam <strong>${allTags.length}</strong> etiket kullanÄ±ldÄ±.</p>
                <p>BaskÄ±n Kategori: <strong>EÄŸlence & Vlog</strong> (Otomatik Tespit)</p>
                <p>FÄ±rsat Skoru: <strong style="color: green;">YÃ¼ksek</strong> (Ã‡eÅŸitlilik Var)</p>
            `;
        }

        btn.addEventListener('click', loadData);
        loadData(); // Ä°lk aÃ§Ä±lÄ±ÅŸta Ã§alÄ±ÅŸtÄ±r
    </script>
</body>
</html>

